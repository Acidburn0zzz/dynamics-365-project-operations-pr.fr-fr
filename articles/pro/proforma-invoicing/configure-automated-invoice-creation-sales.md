---
title: Configurer une création de facture pro forma automatisée
description: Cette rubrique fournit des informations sur la configuration de la création automatique de factures pro forma.
author: rumant
manager: Annbe
ms.date: 10/13/2020
ms.topic: article
ms.service: dynamics-365-customerservice
ms.reviewer: kfend
ms.author: rumant
ms.openlocfilehash: e146dd510b3795d52d164fc6acf8e5400ba11310
ms.sourcegitcommit: 11a61db54119503e82faec5f99c4273e8d1247e5
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/16/2020
ms.locfileid: "4075649"
---
# <a name="configure-automated-proforma-invoice-creation"></a><span data-ttu-id="922bb-103">Configurer une création de facture pro forma automatisée</span><span class="sxs-lookup"><span data-stu-id="922bb-103">Configure automated proforma invoice creation</span></span>

<span data-ttu-id="922bb-104">_**S’applique à :** Déploiement simplifié – Traiter la facturation pro forma_</span><span class="sxs-lookup"><span data-stu-id="922bb-104">_**Applies To:** Lite deployment - deal to proforma invoicing_</span></span>

<span data-ttu-id="922bb-105">Vous pouvez configurer la création automatique de factures dans Dynamics 365 Project Operations.</span><span class="sxs-lookup"><span data-stu-id="922bb-105">You can configure automatic invoice creation in Dynamics 365 Project Operations.</span></span> <span data-ttu-id="922bb-106">Le système crée un projet de facture pro forma basé sur la planification de facture pour chaque contrat de projet et ligne de contrat.</span><span class="sxs-lookup"><span data-stu-id="922bb-106">The system creates a draft proforma invoice based on the invoice schedule for each project contract and contract line.</span></span> <span data-ttu-id="922bb-107">Les planifications de facture sont configurées au niveau de la ligne de contrat.</span><span class="sxs-lookup"><span data-stu-id="922bb-107">Invoice schedules are configured at the contract line level.</span></span> <span data-ttu-id="922bb-108">Chaque ligne d'un contrat peut avoir une planification de facture distincte, ou la même planification de facture peut être incluse sur chaque ligne du contrat.</span><span class="sxs-lookup"><span data-stu-id="922bb-108">Each line on a contract can have a distinct invoice schedule, or the same invoice schedule can be included on every line of the contract.</span></span>

<span data-ttu-id="922bb-109">Lorsque vous créez une facture, le système crée toujours au moins une facture par contrat de projet.</span><span class="sxs-lookup"><span data-stu-id="922bb-109">When you create an invoice, the system always creates at least one invoice per project contract.</span></span> <span data-ttu-id="922bb-110">Dans certains cas, plusieurs factures peuvent être créées.</span><span class="sxs-lookup"><span data-stu-id="922bb-110">In some cases, there may be multiple invoices created.</span></span>

<span data-ttu-id="922bb-111">Par exemple, si le contrat a plusieurs clients, le même nombre de factures que le nombre de clients qui ont des transactions facturables à facturer sera créé sur ce contrat de projet.</span><span class="sxs-lookup"><span data-stu-id="922bb-111">For example, if the contract has multiple customers, the same number of invoices will be created as the number of customers that have billable transactions to invoice on that project contract.</span></span>

## <a name="understand-how-transactions-are-included-on-an-invoice"></a><span data-ttu-id="922bb-112">Comprendre comment les transactions sont incluses sur une facture</span><span class="sxs-lookup"><span data-stu-id="922bb-112">Understand how transactions are included on an invoice</span></span> 

<span data-ttu-id="922bb-113">Parfois, chaque ligne de contrat basée sur un projet spécifie une planification de facture distincte.</span><span class="sxs-lookup"><span data-stu-id="922bb-113">Sometimes, each project-based contract line specifies a separate invoice schedule.</span></span> <span data-ttu-id="922bb-114">Par exemple, les services de mise en œuvre pour le contrat Adatum ont les lignes de contrat suivantes :</span><span class="sxs-lookup"><span data-stu-id="922bb-114">For example, implementation services for the Adatum contract have the following contract lines:</span></span>

- <span data-ttu-id="922bb-115">Travail prototype qui est un prix fixe avec deux jalons créés manuellement.</span><span class="sxs-lookup"><span data-stu-id="922bb-115">Prototype work that is a fixed price with two manually created milestones.</span></span>
- <span data-ttu-id="922bb-116">Travail de mise en œuvre qui comprend le temps et sera facturé toutes les deux semaines le lundi.</span><span class="sxs-lookup"><span data-stu-id="922bb-116">Implementation work that includes Time and will be billed bi-weekly on Mondays.</span></span>
- <span data-ttu-id="922bb-117">Les dépenses engagées qui doivent être facturées mensuellement le premier lundi de chaque mois.</span><span class="sxs-lookup"><span data-stu-id="922bb-117">Expenses incurred that need to be billed monthly on the first Monday of each month.</span></span>

<span data-ttu-id="922bb-118">Les planifications de facture définies sur chacun de ces deux éléments de ligne ressemblent au tableau suivant :</span><span class="sxs-lookup"><span data-stu-id="922bb-118">Invoice schedules defined on each of these two line items look like the following table:</span></span>

| <span data-ttu-id="922bb-119">Ligne de contrat</span><span class="sxs-lookup"><span data-stu-id="922bb-119">Contract line</span></span> | <span data-ttu-id="922bb-120">Date d'exécution de la facture</span><span class="sxs-lookup"><span data-stu-id="922bb-120">Invoice run date</span></span> | <span data-ttu-id="922bb-121">Date butoir de la transaction</span><span class="sxs-lookup"><span data-stu-id="922bb-121">Transaction cut-off date</span></span> | <span data-ttu-id="922bb-122">Date du jalon</span><span class="sxs-lookup"><span data-stu-id="922bb-122">Milestone date</span></span> | <span data-ttu-id="922bb-123">Montant du jalon</span><span class="sxs-lookup"><span data-stu-id="922bb-123">Milestone amount</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="922bb-124">Travail prototype</span><span class="sxs-lookup"><span data-stu-id="922bb-124">Prototype work</span></span> | <span data-ttu-id="922bb-125">Lundi 5 octobre</span><span class="sxs-lookup"><span data-stu-id="922bb-125">October 5, Monday</span></span> | - | <span data-ttu-id="922bb-126">Lundi 5 octobre</span><span class="sxs-lookup"><span data-stu-id="922bb-126">October 5, Monday</span></span> | <span data-ttu-id="922bb-127">5 000 USD</span><span class="sxs-lookup"><span data-stu-id="922bb-127">5000 USD</span></span> |
| - | <span data-ttu-id="922bb-128">Mardi 3 novembre</span><span class="sxs-lookup"><span data-stu-id="922bb-128">November 3, Tuesday</span></span> | - | <span data-ttu-id="922bb-129">Mardi 3 novembre</span><span class="sxs-lookup"><span data-stu-id="922bb-129">November 3, Tuesday</span></span> | <span data-ttu-id="922bb-130">12 000 USD</span><span class="sxs-lookup"><span data-stu-id="922bb-130">12,000 USD</span></span> |
| <span data-ttu-id="922bb-131">Travail d'implémentation</span><span class="sxs-lookup"><span data-stu-id="922bb-131">Implementation work</span></span> | <span data-ttu-id="922bb-132">Lundi 5 octobre</span><span class="sxs-lookup"><span data-stu-id="922bb-132">October 5, Monday</span></span> | <span data-ttu-id="922bb-133">Dimanche 4 octobre</span><span class="sxs-lookup"><span data-stu-id="922bb-133">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="922bb-134">Lundi 19 octobre</span><span class="sxs-lookup"><span data-stu-id="922bb-134">October 19, Monday</span></span> | <span data-ttu-id="922bb-135">Dimanche 18 octobre</span><span class="sxs-lookup"><span data-stu-id="922bb-135">October 18, Sunday</span></span> | - | - |
| - | <span data-ttu-id="922bb-136">Lundi 2 novembre</span><span class="sxs-lookup"><span data-stu-id="922bb-136">November 2, Monday</span></span> | <span data-ttu-id="922bb-137">Dimanche 1er novembre</span><span class="sxs-lookup"><span data-stu-id="922bb-137">November 1, Sunday</span></span> | - | - |
| - | <span data-ttu-id="922bb-138">Lundi 16 novembre</span><span class="sxs-lookup"><span data-stu-id="922bb-138">November 16, Monday</span></span> | <span data-ttu-id="922bb-139">Dimanche 15 novembre</span><span class="sxs-lookup"><span data-stu-id="922bb-139">November 15, Sunday</span></span> | - | - |
| <span data-ttu-id="922bb-140">Dépenses engagées</span><span class="sxs-lookup"><span data-stu-id="922bb-140">Expenses incurred</span></span> | <span data-ttu-id="922bb-141">Lundi 5 octobre</span><span class="sxs-lookup"><span data-stu-id="922bb-141">October 5, Monday</span></span> | <span data-ttu-id="922bb-142">Dimanche 4 octobre</span><span class="sxs-lookup"><span data-stu-id="922bb-142">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="922bb-143">Lundi 2 novembre</span><span class="sxs-lookup"><span data-stu-id="922bb-143">November 2, Monday</span></span> | <span data-ttu-id="922bb-144">Dimanche 1er novembre</span><span class="sxs-lookup"><span data-stu-id="922bb-144">November 1, Sunday</span></span> | - | - |

<span data-ttu-id="922bb-145">Dans cet exemple, lorsque la facturation automatique s'exécute sur :</span><span class="sxs-lookup"><span data-stu-id="922bb-145">In this example when the automatic invoicing runs on:</span></span>

- <span data-ttu-id="922bb-146">**4 octobre ou à toute date antérieure**  : Aucune facture n'est générée pour ce contrat car la table **planification de facture** pour chacune de ces lignes de contrat n'indique pas le dimanche 4 octobre comme date d'exécution de la facture.</span><span class="sxs-lookup"><span data-stu-id="922bb-146">**October 4 or any date before** : No invoice is generated for this contract because the **Invoice Schedule** table for each of these contract lines doesn't call out October 4, Sunday as an invoice run date.</span></span>
- <span data-ttu-id="922bb-147">**Lundi 5 octobre**  : Une facture est générée pour :</span><span class="sxs-lookup"><span data-stu-id="922bb-147">**October 5 Monday** : One invoice is generated for:</span></span>

    - <span data-ttu-id="922bb-148">Travail de prototype qui inclut le jalon, s'il est marqué comme **Prêt à facturer**.</span><span class="sxs-lookup"><span data-stu-id="922bb-148">Prototype work that includes the milestone, if it is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="922bb-149">Travail de mise en œuvre qui comprend toutes les transactions de temps créées avant la date limite de transaction du dimanche 4 octobre, avec le marquage **Prêt à facturer**.</span><span class="sxs-lookup"><span data-stu-id="922bb-149">Implementation work that includes all Time transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="922bb-150">Les dépenses engagées qui comprennent toutes les transactions de dépenses créées avant la date limite de transaction du dimanche 4 octobre, avec le marquage **Prêt à facturer**.</span><span class="sxs-lookup"><span data-stu-id="922bb-150">Expense incurred that includes all Expense transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
  
- <span data-ttu-id="922bb-151">**6 octobre ou à toute date antérieure au 19 octobre**  : Aucune facture n'est générée pour ce contrat car la table **planification de facture** pour chacune de ces lignes de contrat n'indique pas le 6 octobre ou toute date antérieure au 19 octobre comme date d'exécution de la facture.</span><span class="sxs-lookup"><span data-stu-id="922bb-151">**On October 6 or any date before October 19** : No invoice is generated for this contract since the **Invoice Schedule** table for each of these contract lines does not call out October 6 or any date before October 19 as an invoice run date.</span></span>
- <span data-ttu-id="922bb-152">**Lundi 19 octobre**  : Une facture est générée pour le travail de mise en œuvre qui comprend toutes les transactions de temps créées avant la date limite de transaction du dimanche 18 octobre, avec le marquage  **Prêt à facturer**.</span><span class="sxs-lookup"><span data-stu-id="922bb-152">**October 19, Monday** : One invoice is generated for implementation work that includes all Time transactions created before the transaction cut-off date of October 18, Sunday, that is marked as **Ready to Invoice**.</span></span>
- <span data-ttu-id="922bb-153">**Lundi 2 novembre**  : Une facture est générée pour :</span><span class="sxs-lookup"><span data-stu-id="922bb-153">**November 2 Monday** : One invoice is generated for:</span></span>

    - <span data-ttu-id="922bb-154">Travail de mise en œuvre qui comprend toutes les transactions de temps créées avant la date limite de transaction du dimanche 1er novembre, avec le marquage **Prêt à facturer**.</span><span class="sxs-lookup"><span data-stu-id="922bb-154">Implementation work that includes all Time transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="922bb-155">Les dépenses engagées qui comprennent toutes les transactions de dépenses créées avant la date limite de transaction du dimanche 1er novembre, avec le marquage **Prêt à facturer**.</span><span class="sxs-lookup"><span data-stu-id="922bb-155">Expense incurred that includes all Expense transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>

- <span data-ttu-id="922bb-156">**Mardi 3 novembre**  : Une facture est générée pour le travail de prototype qui inclut le jalon pour 12 000 USD, s'il est marqué comme **Prêt à facturer**.</span><span class="sxs-lookup"><span data-stu-id="922bb-156">**November 3, Tuesday** : One invoice is generated for prototype work that includes the milestone for 12000 USD, if it is marked as **Ready to Invoice**.</span></span>

## <a name="configure-automatic-invoicing"></a><span data-ttu-id="922bb-157">Configurer la facturation automatique</span><span class="sxs-lookup"><span data-stu-id="922bb-157">Configure automatic invoicing</span></span>

<span data-ttu-id="922bb-158">Procédez comme suit pour configurer l'exécution d'une facture automatique.</span><span class="sxs-lookup"><span data-stu-id="922bb-158">Complete the following steps to configure an automated invoice run.</span></span>

1. <span data-ttu-id="922bb-159">Dans **Project Operations** , accédez à **Paramètres** > **Configuration de facture périodique**.</span><span class="sxs-lookup"><span data-stu-id="922bb-159">In **Project Operations** , go to **Settings** > **Recurring Invoice Setup**.</span></span>
2. <span data-ttu-id="922bb-160">Créez un traitement par lots, et nommez-le **Créer des factures dans Project Operations**.</span><span class="sxs-lookup"><span data-stu-id="922bb-160">Create a batch job, and name it **rPoject Operations Create Invoices**.</span></span> <span data-ttu-id="922bb-161">Le nom du traitement par lots doit inclure les mots « Créer des factures ».</span><span class="sxs-lookup"><span data-stu-id="922bb-161">The name of the batch job must include the words, "create invoices".</span></span>
3. <span data-ttu-id="922bb-162">Dans le champ **Type de tâche** , sélectionnez **Aucun**.</span><span class="sxs-lookup"><span data-stu-id="922bb-162">In the **Job Type** field, select **None**.</span></span> <span data-ttu-id="922bb-163">Par défaut, les champs **Fréquence quotidienne** et **Est actif** sont définies sur **Oui**.</span><span class="sxs-lookup"><span data-stu-id="922bb-163">By default, the **Frequency Daily** and **Is Active** fields are set to **Yes**.</span></span>
4. <span data-ttu-id="922bb-164">Sélectionnez **Exécuter le flux de travail**.</span><span class="sxs-lookup"><span data-stu-id="922bb-164">Select **Run Workflow**.</span></span> <span data-ttu-id="922bb-165">Dans la boîte de dialogue **Rechercher un enregistrement** , vous verrez trois workflows :</span><span class="sxs-lookup"><span data-stu-id="922bb-165">In the **Look Up Record** dialog box, you will see three workflows:</span></span>

- <span data-ttu-id="922bb-166">ProcessRunCaller</span><span class="sxs-lookup"><span data-stu-id="922bb-166">ProcessRunCaller</span></span>
- <span data-ttu-id="922bb-167">ProcessRunner</span><span class="sxs-lookup"><span data-stu-id="922bb-167">ProcessRunner</span></span>
- <span data-ttu-id="922bb-168">UpdateRoleUtilization</span><span class="sxs-lookup"><span data-stu-id="922bb-168">UpdateRoleUtilization</span></span>

5. <span data-ttu-id="922bb-169">Sélectionnez **ProcessRunCaller** , puis **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="922bb-169">Select **ProcessRunCaller** , and then select **Add**.</span></span>
6. <span data-ttu-id="922bb-170">Dans la boîte de dialogue suivante, sélectionnez **OK**.</span><span class="sxs-lookup"><span data-stu-id="922bb-170">In the next dialog box, select **OK**.</span></span> <span data-ttu-id="922bb-171">Un workflow **Veille** est suivi d'un workflow **Processus**.</span><span class="sxs-lookup"><span data-stu-id="922bb-171">A **Sleep** workflow is followed by a **Process** workflow.</span></span> 

> [!NOTE]
> <span data-ttu-id="922bb-172">Vous pouvez également sélectionner **ProcessRunner** à l'étape 5.</span><span class="sxs-lookup"><span data-stu-id="922bb-172">You can also select **ProcessRunner** in step 5.</span></span> <span data-ttu-id="922bb-173">Ensuite, lorsque vous sélectionnez **OK** , un workflow **Processus** est suivi d'un workflow **Veille**.</span><span class="sxs-lookup"><span data-stu-id="922bb-173">Then, when you select **OK** , a **Process** workflow is followed by a **Sleep** workflow.</span></span>

<span data-ttu-id="922bb-174">Les workflows **ProcessRunCaller** et **ProcessRunner** créent des factures.</span><span class="sxs-lookup"><span data-stu-id="922bb-174">The **ProcessRunCaller** and **ProcessRunner** workflows create invoices.</span></span> <span data-ttu-id="922bb-175">**ProcessRunCaller** appelle **ProcessRunner**.</span><span class="sxs-lookup"><span data-stu-id="922bb-175">**ProcessRunCaller** calls **ProcessRunner**.</span></span> <span data-ttu-id="922bb-176">**ProcessRunner** est le workflow qui crée en fait les factures.</span><span class="sxs-lookup"><span data-stu-id="922bb-176">**ProcessRunner** is the workflow that actually creates the invoices.</span></span> <span data-ttu-id="922bb-177">Le workflow traverse toutes les lignes de contrat pour lesquelles des factures doivent être créées, et crée des factures pour ces lignes.</span><span class="sxs-lookup"><span data-stu-id="922bb-177">The workflow goes through all the contract lines that invoices must be created for, and creates invoices for those lines.</span></span> <span data-ttu-id="922bb-178">Pour déterminer les lignes de contrat pour lesquelles des factures doivent être créées, la tâche recherche les dates d'exécution de factures des lignes de contrat.</span><span class="sxs-lookup"><span data-stu-id="922bb-178">To determine the contract lines that invoices must be created for, the job looks at invoice run dates for the contract lines.</span></span> <span data-ttu-id="922bb-179">Si des lignes de contrat qui appartiennent à un contrat disposent de la même date d'exécution de factures, les transactions sont combinées en une seule facture avec deux lignes de facture.</span><span class="sxs-lookup"><span data-stu-id="922bb-179">If contract lines that belong to one contract have the same invoice run date, the transactions are combined into one invoice that has two invoice lines.</span></span> <span data-ttu-id="922bb-180">S'il n'existe pas de transaction pour créer des factures, la tâche ignore la création de facture.</span><span class="sxs-lookup"><span data-stu-id="922bb-180">If there are no transactions to create invoices for, the job skips creating an invoice.</span></span>

<span data-ttu-id="922bb-181">Une fois que **ProcessRunner** a fini de s'exécuter, il appelle **ProcessRunCaller** , fournit l'heure de fin, et est fermé.</span><span class="sxs-lookup"><span data-stu-id="922bb-181">After **ProcessRunner** has finished running, it calls **ProcessRunCaller** , provides the end time, and is closed.</span></span> <span data-ttu-id="922bb-182">**ProcessRunCaller** lance alors une minuterie qui s'exécute pendant 24 heures à partir de l'heure de fin spécifiée.</span><span class="sxs-lookup"><span data-stu-id="922bb-182">**ProcessRunCaller** then starts a timer that runs for 24-hours from the specified end time.</span></span> <span data-ttu-id="922bb-183">À la fin de la minuterie, **ProcessRunCaller** est fermé.</span><span class="sxs-lookup"><span data-stu-id="922bb-183">At the end of the timer, **ProcessRunCaller** is closed.</span></span>

<span data-ttu-id="922bb-184">La tâche de traitement par lots pour la création de factures est une tâche périodique.</span><span class="sxs-lookup"><span data-stu-id="922bb-184">The batch process job for creating invoices is a recurrent job.</span></span> <span data-ttu-id="922bb-185">Si ce traitement par lots est exécuté de nombreuses fois, plusieurs instances de la tâche sont créées et entraînent des erreurs.</span><span class="sxs-lookup"><span data-stu-id="922bb-185">If this batch process is run many times, multiple instances of the job are created and causes errors.</span></span> <span data-ttu-id="922bb-186">Par conséquent, vous devez démarrer le traitement par lots une seule fois, et redémarrer uniquement s'il cesse de s'exécuter.</span><span class="sxs-lookup"><span data-stu-id="922bb-186">Therefore, you should start the batch process only one time, and then restart only if it stops running.</span></span>

> [!NOTE]
> <span data-ttu-id="922bb-187">La facturation par lots dans Project Operations ne s'exécute que pour les lignes de contrat de projet qui sont configurées par des planifications de facture.</span><span class="sxs-lookup"><span data-stu-id="922bb-187">Batch invoicing in Project Operations only runs for project contract lines that are configured by invoice schedules.</span></span> <span data-ttu-id="922bb-188">Une ligne de contrat avec une méthode de facturation à prix fixe doit avoir des jalons configurés.</span><span class="sxs-lookup"><span data-stu-id="922bb-188">A contract line with a fixed price billing method must have milestones configured.</span></span> <span data-ttu-id="922bb-189">Une ligne de contrat de projet avec une méthode de facturation en régie nécessite la configuration d'un calendrier de facturation basé sur la date.</span><span class="sxs-lookup"><span data-stu-id="922bb-189">A project contract line with a time and material billing method will need a date-based invoice schedule set up.</span></span>
